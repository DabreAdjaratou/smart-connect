<?php
$receivedTotal = 0;$receivedDate = '';
$testedTotal = 0;$testedDate = '';
$rejectedTotal = 0;$rejectedDate = '';
$quickStats = $result['quickStats'];
if(count($result['scResult'])>0){
    $received = end($result['scResult']);
    $receivedTotal = $received['receivedTotal'];
    $receivedDate = $received['receivedDate'];
}if(count($result['stResult'])>0){
    $tested = end($result['stResult']);
    $testedTotal = $tested['testedTotal'];
    $testedDate = $tested['testedDate'];
}if(count($result['srResult'])>0){
    $reject = end($result['srResult']);
    $rejectedTotal = $reject['rejectTotal'];
    $rejectedDate = $reject['rejectDate'];
}
?>

<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
    <div class="dashboard-stat2 " style="cursor:pointer;">
        <div class="display">
            <div class="number">
                <h3 class="font-purple-soft">
                    <span style="font-size:25px;">Quick Stats</span>
                </h3>
                <small class="font-purple-soft" style="font-size:12px;">as on <?php echo date("dS M Y"); ?></small><br>
            </div>
            <div class="icon">
                <i class="icon-pie-chart"></i>
            </div>
        </div>
        <div id="samplesWaitingChart" width="210" height="150" style="min-height:150px;">
            
            <table class="table table-striped table-hover table-compressed">
                <?php foreach($quickStats as $statName => $statValue) { ?>
                <tr>
                    <th><?php echo $statName ?></th>
                    <td><?php echo number_format($statValue) ?></td>
                    
                </tr>
                <?php } ?>
            </table>
            
        </div>
    </div>
</div>
<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12 ">
    <div class="dashboard-stat2 bluebox" style="cursor:pointer;" >
        <div class="display">
            <div class="number">
                <h3 class="font-green-sharp">
                    <span data-counter="counterup" data-value="<?php echo $receivedTotal; ?>"><?php echo $receivedTotal; ?></span>
                </h3>
                <small class="font-green-sharp">SAMPLES ACCESSION</small><br>
                <!--<small class="font-green-sharp"><?php echo $receivedDate;?></small>-->
            </div>
            <div class="icon">
                <i class="icon-pie-chart"></i>
            </div>
        </div>
        <div id="samplesReceivedChart" width="210" height="150" style="min-height:180px;"></div>
    </div>
</div>

<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
    <div class="dashboard-stat2 " style="cursor:pointer;" >
        <div class="display">
            <div class="number">
                <h3 class="font-blue-sharp">
                    <span data-counter="counterup" data-value="<?php echo $testedTotal; ?>"><?php echo $testedTotal; ?></span>
                </h3>
                <small class="font-blue-sharp">SAMPLES TESTED</small><br>
                <!--<small class="font-blue-sharp"><?php echo $testedDate;?></small>-->
            </div>
            <div class="icon">
                <i class="icon-pie-chart"></i>
            </div>
        </div>
        <div id="samplesTestedChart" width="210" height="150" style="min-height:180px;"></div>
    </div>
</div>
<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
    <div class="dashboard-stat2 " style="cursor:pointer;" >
        <div class="display">
            <div class="number">
                <h3 class="font-red-haze">
                    <span data-counter="counterup" data-value="<?php echo $rejectedTotal; ?>"><?php echo $rejectedTotal; ?></span>
                </h3>
                <small class="font-red-haze">SAMPLES REJECTED</small><br>
                <!--<small class="font-red-haze"><?php echo $rejectedDate;?></small>-->
            </div>
            <div class="icon">
                <i class="icon-pie-chart"></i>
            </div>
        </div>
        <div id="samplesRejectedChart" width="210" height="150" style="min-height:180px;"></div>
    </div>
</div>
<script>
    <?php
    if(isset($result['scResult']) && count($result['scResult'])>0){
        if($receivedTotal>0){
        ?>
      
    $('#samplesReceivedChart').highcharts({
        chart: {
            type: 'column',
            height: 180
        },
        title: {
            text: ''
        },
        subtitle: {
            text: ''
        },
        credits: {
            enabled: false
        },
        xAxis: {
            categories: [
            <?php
            foreach($result['scResult'] as $total){
                echo "'".ucwords($total['date'])."',";
            }
            ?>],
            crosshair: true
        },
        yAxis: {
            min: 0,
            title: {
                text: null
            },
            labels: { formatter: function() { return this.value; } },
        },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                '<td style="padding:0"><b>{point.y}</b></td></tr>',
            footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0,
                cursor: 'pointer',
                //point: {
                //    events: {
                //        click: function () {
                //            window.location.href='/labs/samples-accession';
                //        }
                //    }
                //}                
            }
        },
        series: [{
            showInLegend: false,  
            name: 'Samples Received',
            data: [<?php
            foreach($result['scResult'] as $total){
                echo ucwords($total[0]['total']).",";
            }
            ?>]

        }],
        colors : ['#2ab4c0']
    });
    <?php } 

    if($testedTotal>0){
    ?>
      
$('#samplesTestedChart').highcharts({
        chart: {
            type: 'column',
            height: 180
        },
        title: {
            text: ''
        },
        subtitle: {
            text: ''
        },
        credits: {
            enabled: false
        },
        xAxis: {
            categories: [<?php
            foreach($result['stResult'] as $total){
                echo "'".ucwords($total['date'])."',";
            }
            ?>],
            crosshair: true
        },
        yAxis: {
            min: 0,
            title: {
                text: null
            },
            labels: { formatter: function() { return this.value; } },
        },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                '<td style="padding:0"><b>{point.y}</b></td></tr>',
            footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0,
                cursor: 'pointer',
            }
        },
        series: [{
            showInLegend: false,  
            name: 'Samples Tested',
            data: [<?php
            foreach($result['stResult'] as $total){
                echo ucwords($total[0]['total']).",";
            }
            ?>]

        }],
        colors : ['#f36a5a']
    });        
<?php }
if($rejectedTotal>0){
?>
$('#samplesRejectedChart').highcharts({
        chart: {
            type: 'column',
            height: 180
        },
        title: {
            text: ''
        },
        subtitle: {
            text: ''
        },
        credits: {
            enabled: false
        },
        xAxis: {
            categories: [<?php
            foreach($result['srResult'] as $total){
                echo "'".ucwords($total['date'])."',";
            }
            ?>],
            crosshair: true
        },
        yAxis: {
            min: 0,
            title: {
                text: null
            }
        },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                '<td style="padding:0"><b>{point.y}</b></td></tr>',
            footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0,
                cursor: 'pointer',
            }
        },
        series: [{
            showInLegend: false,  
            name: 'Samples Rejected',
            data: [<?php
            foreach($result['srResult'] as $total){
                echo ucwords($total[0]['total']).",";
            }
            ?>]

        }],
        colors : ['#5C9BD1']
    });   
    <?php } }?>
</script>